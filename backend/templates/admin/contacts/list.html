{% extends 'admin/base.html' %}
{% load static %}

{% block title %}Contact Messages - E-Commerce Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Contact Messages</h1>
</div>

<!-- Statistics -->
<div style="display: flex; gap: 16px; margin-bottom: 24px; align-items: center; flex-wrap: wrap;">
    <div style="background: white; border-radius: 10px; padding: 16px 24px; display: flex; align-items: center; gap: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;">
        <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #ef4444, #dc2626); display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-envelope" style="color: white; font-size: 16px;"></i>
        </div>
        <div>
            <div style="font-size: 24px; font-weight: 700; color: #1f2937;">{{ new_count }}</div>
            <div style="font-size: 13px; color: #64748b;">New</div>
        </div>
    </div>

    <div style="background: white; border-radius: 10px; padding: 16px 24px; display: flex; align-items: center; gap: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;">
        <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #3b82f6, #2563eb); display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-eye" style="color: white; font-size: 16px;"></i>
        </div>
        <div>
            <div style="font-size: 24px; font-weight: 700; color: #1f2937;">{{ read_count }}</div>
            <div style="font-size: 13px; color: #64748b;">Read</div>
        </div>
    </div>

    <div style="background: white; border-radius: 10px; padding: 16px 24px; display: flex; align-items: center; gap: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;">
        <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #f59e0b, #d97706); display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-reply" style="color: white; font-size: 16px;"></i>
        </div>
        <div>
            <div style="font-size: 24px; font-weight: 700; color: #1f2937;">{{ replied_count }}</div>
            <div style="font-size: 13px; color: #64748b;">Replied</div>
        </div>
    </div>

    <div style="background: white; border-radius: 10px; padding: 16px 24px; display: flex; align-items: center; gap: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;">
        <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #10b981, #059669); display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-check-circle" style="color: white; font-size: 16px;"></i>
        </div>
        <div>
            <div style="font-size: 24px; font-weight: 700; color: #1f2937;">{{ resolved_count }}</div>
            <div style="font-size: 13px; color: #64748b;">Resolved</div>
        </div>
    </div>
</div>

<!-- Messages Table -->
<div class="data-table">
    <div class="table-header">
        <h3 class="table-title">All Messages</h3>
    </div>

    <!-- Filter Section -->
    <div style="padding: 16px 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
        <form method="GET" style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
            <select name="status" style="padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; min-width: 140px; background: white;">
                <option value="">All Status</option>
                {% for choice in status_choices %}
                <option value="{{ choice.0 }}" {% if choice.0 == status_filter %}selected{% endif %}>{{ choice.1 }}</option>
                {% endfor %}
            </select>

            <select name="subject" style="padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; min-width: 140px; background: white;">
                <option value="">All Subjects</option>
                {% for choice in subject_choices %}
                <option value="{{ choice.0 }}" {% if choice.0 == subject_filter %}selected{% endif %}>{{ choice.1 }}</option>
                {% endfor %}
            </select>

            <button type="submit" class="btn btn-primary">
                <i class="fas fa-filter"></i> Filter
            </button>

            {% if status_filter or subject_filter %}
            <a href="{% url 'contacts:contact_list' %}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Clear
            </a>
            {% endif %}
        </form>
    </div>

    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Subject</th>
                    <th>Message Preview</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for contact in contacts %}
                <tr {% if contact.status == 'new' %}style="background: #fef3c7;"{% endif %}>
                    <td>
                        <strong>{{ contact.name }}</strong>
                        {% if contact.phone %}
                        <br><small style="color: #6b7280;">{{ contact.phone }}</small>
                        {% endif %}
                    </td>
                    <td>{{ contact.email }}</td>
                    <td>
                        <span style="padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500;
                            {% if contact.subject == 'complaint' %}background: #fee2e2; color: #b91c1c;
                            {% elif contact.subject == 'order' %}background: #dbeafe; color: #1d4ed8;
                            {% elif contact.subject == 'feedback' %}background: #d1fae5; color: #047857;
                            {% else %}background: #f3f4f6; color: #374151;{% endif %}">
                            {{ contact.get_subject_display }}
                        </span>
                    </td>
                    <td style="max-width: 250px;">
                        <div style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            {{ contact.message|truncatechars:60 }}
                        </div>
                    </td>
                    <td>
                        <span style="padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500;
                            {% if contact.status == 'new' %}background: #fef3c7; color: #b45309;
                            {% elif contact.status == 'read' %}background: #dbeafe; color: #1d4ed8;
                            {% elif contact.status == 'replied' %}background: #fce7f3; color: #be185d;
                            {% else %}background: #d1fae5; color: #047857;{% endif %}">
                            {{ contact.get_status_display }}
                        </span>
                    </td>
                    <td style="white-space: nowrap;">{{ contact.created_at|date:"M d, Y" }}<br><small>{{ contact.created_at|time:"H:i" }}</small></td>
                    <td>
                        <a href="{% url 'contacts:contact_detail' contact.pk %}" class="btn btn-sm btn-primary">
                            <i class="fas fa-eye"></i> View
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; display: block;"></i>
                        No contact messages found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if contacts.has_other_pages %}
    <div style="padding: 16px 20px; display: flex; justify-content: center; gap: 8px;">
        {% if contacts.has_previous %}
        <a href="?page={{ contacts.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if subject_filter %}&subject={{ subject_filter }}{% endif %}" class="btn btn-secondary btn-sm">Previous</a>
        {% endif %}

        <span style="padding: 8px 16px; background: #f3f4f6; border-radius: 6px;">
            Page {{ contacts.number }} of {{ contacts.paginator.num_pages }}
        </span>

        {% if contacts.has_next %}
        <a href="?page={{ contacts.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if subject_filter %}&subject={{ subject_filter }}{% endif %}" class="btn btn-secondary btn-sm">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
