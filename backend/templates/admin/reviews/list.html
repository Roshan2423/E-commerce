{% extends 'admin/base.html' %}
{% load static %}

{% block title %}Reviews - E-Commerce Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Reviews</h1>
</div>

<!-- Review Statistics -->
<div style="display: flex; gap: 16px; margin-bottom: 24px; align-items: center;">
    <div style="background: white; border-radius: 10px; padding: 16px 24px; display: flex; align-items: center; gap: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;">
        <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-star" style="color: white; font-size: 16px;"></i>
        </div>
        <div>
            <div style="font-size: 24px; font-weight: 700; color: #1f2937;">{{ reviews|length }}</div>
            <div style="font-size: 13px; color: #64748b;">Total Reviews</div>
        </div>
    </div>

    <div style="background: white; border-radius: 10px; padding: 16px 24px; display: flex; align-items: center; gap: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;">
        <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #f59e0b, #d97706); display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-clock" style="color: white; font-size: 16px;"></i>
        </div>
        <div>
            <div style="font-size: 24px; font-weight: 700; color: #1f2937;">{{ pending_count }}</div>
            <div style="font-size: 13px; color: #64748b;">Pending Approval</div>
        </div>
    </div>
</div>

<!-- Reviews Table -->
<div class="data-table">
    <div class="table-header">
        <h3 class="table-title">All Reviews</h3>
    </div>

    <!-- Search and Filter Section -->
    <div style="padding: 16px 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
        <form method="GET" style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
            <input type="text" name="search" placeholder="Search by product or customer..." value="{{ search }}"
                   style="padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; min-width: 300px; flex: 1;">

            <select name="status" style="padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; min-width: 140px; background: white;">
                <option value="">All Status</option>
                <option value="pending" {% if selected_status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="approved" {% if selected_status == 'approved' %}selected{% endif %}>Approved</option>
                <option value="rejected" {% if selected_status == 'rejected' %}selected{% endif %}>Rejected</option>
            </select>

            <select name="rating" style="padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; min-width: 140px; background: white;">
                <option value="">All Ratings</option>
                <option value="5" {% if selected_rating == '5' %}selected{% endif %}>5 Stars</option>
                <option value="4" {% if selected_rating == '4' %}selected{% endif %}>4 Stars</option>
                <option value="3" {% if selected_rating == '3' %}selected{% endif %}>3 Stars</option>
                <option value="2" {% if selected_rating == '2' %}selected{% endif %}>2 Stars</option>
                <option value="1" {% if selected_rating == '1' %}selected{% endif %}>1 Star</option>
            </select>

            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Search
            </button>

            {% if search or selected_status or selected_rating %}
            <a href="{% url 'products:reviews' %}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Clear
            </a>
            {% endif %}
        </form>
    </div>

    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Product</th>
                    <th style="text-align: center;">Customer</th>
                    <th style="text-align: center;">Rating</th>
                    <th>Review</th>
                    <th style="text-align: center;">Date</th>
                    <th style="text-align: center;">Status</th>
                    <th style="text-align: center;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for review in reviews %}
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 50px; height: 50px; border-radius: 8px; overflow: hidden; background: #f1f5f9; display: flex; align-items: center; justify-content: center;">
                                {% if review.product.get_main_image %}
                                <img src="{{ review.product.get_main_image }}" alt="{{ review.product.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                                {% else %}
                                <i class="fas fa-image" style="color: #94a3b8;"></i>
                                {% endif %}
                            </div>
                            <div>
                                <div style="font-weight: 500; color: #1f2937;">{{ review.product.name|truncatechars:30 }}</div>
                                <div style="font-size: 12px; color: #64748b;">SKU: {{ review.product.sku }}</div>
                            </div>
                        </div>
                    </td>
                    <td style="text-align: center;">
                        <div style="font-weight: 500; color: #1f2937;">{{ review.user.get_full_name|default:review.user.username }}</div>
                        <div style="font-size: 12px; color: #64748b;">{{ review.user.email }}</div>
                        {% if review.is_verified_purchase %}
                        <span style="display: inline-block; padding: 2px 8px; background: #dcfce7; color: #16a34a; border-radius: 9999px; font-size: 10px; font-weight: 600; margin-top: 4px;">
                            <i class="fas fa-check-circle"></i> Verified
                        </span>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">
                        <div class="star-rating">
                            {% for i in "12345" %}
                            <i class="fas fa-star" style="color: {% if forloop.counter <= review.rating %}#fbbf24{% else %}#e5e7eb{% endif %}; font-size: 14px;"></i>
                            {% endfor %}
                        </div>
                    </td>
                    <td style="max-width: 300px;">
                        {% if review.title %}
                        <div style="font-weight: 500; color: #1f2937; margin-bottom: 4px;">{{ review.title|truncatechars:50 }}</div>
                        {% endif %}
                        <div style="font-size: 13px; color: #64748b; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ review.comment|truncatechars:80 }}</div>
                        {% if review.images.count > 0 %}
                        <div style="margin-top: 4px; font-size: 11px; color: #6366f1;">
                            <i class="fas fa-images"></i> {{ review.images.count }} image{{ review.images.count|pluralize }}
                        </div>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">
                        <div style="font-size: 13px; color: #1f2937;">{{ review.created_at|date:"d M, Y" }}</div>
                        <div style="font-size: 11px; color: #64748b;">{{ review.created_at|time:"h:i A" }}</div>
                    </td>
                    <td style="text-align: center;">
                        <span class="badge {% if review.status == 'approved' %}success{% elif review.status == 'pending' %}warning{% else %}danger{% endif %}">
                            {{ review.get_status_display }}
                        </span>
                    </td>
                    <td style="text-align: center;">
                        <div style="display: flex; gap: 8px; justify-content: center;">
                            {% if review.status == 'pending' %}
                            <a href="{% url 'products:review_action' review.id 'approve' %}" class="btn btn-sm" style="background: #dcfce7; color: #16a34a; padding: 6px 12px;" title="Approve">
                                <i class="fas fa-check"></i>
                            </a>
                            <a href="{% url 'products:review_action' review.id 'reject' %}" class="btn btn-sm" style="background: #fee2e2; color: #dc2626; padding: 6px 12px;" title="Reject">
                                <i class="fas fa-times"></i>
                            </a>
                            {% endif %}
                            <a href="{% url 'products:review_detail' review.id %}" class="btn btn-sm" style="background: #e0e7ff; color: #4f46e5; padding: 6px 12px;" title="View">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{% url 'products:review_edit' review.id %}" class="btn btn-sm" style="background: #fef3c7; color: #d97706; padding: 6px 12px;" title="Edit">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="{% url 'products:review_delete' review.id %}" class="btn btn-sm" style="background: #fee2e2; color: #dc2626; padding: 6px 12px;" title="Delete">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 60px; color: #64748b;">
                        <i class="fas fa-star fa-3x" style="margin-bottom: 16px; opacity: 0.3;"></i>
                        <br>
                        <strong>No reviews found</strong>
                        <br>
                        <small>Reviews from customers will appear here</small>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<style>
.star-rating {
    display: flex;
    gap: 2px;
    justify-content: center;
}

.btn-sm {
    font-size: 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-sm:hover {
    opacity: 0.8;
    transform: translateY(-1px);
}
</style>
{% endblock %}
