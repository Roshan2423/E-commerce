{% extends 'admin/base.html' %}
{% load static %}

{% block title %}{{ vendor.business_name }} - Business Details{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-content">
        <h1 class="page-title">{{ vendor.business_name }}</h1>
        <p class="page-subtitle">Business details and statistics</p>
    </div>
    <div class="header-actions">
        <a href="{% url 'vendor_admin:list' %}" class="btn btn-outline">
            <i class="fas fa-arrow-left"></i>
            <span>Back to List</span>
        </a>
        <a href="{% url 'vendor:dashboard' %}?vendor_id={{ vendor.pk }}" class="btn btn-success" target="_blank">
            <i class="fas fa-user-shield"></i>
            <span>View as Vendor</span>
        </a>
        <a href="/v/{{ vendor.slug }}/" class="btn btn-outline" target="_blank">
            <i class="fas fa-store"></i>
            <span>View Store</span>
        </a>
        <button type="button" class="btn btn-primary" onclick="showEditModal()">
            <i class="fas fa-edit"></i>
            <span>Edit Business</span>
        </button>
    </div>
</div>

<div class="detail-grid">
    <!-- Business Info -->
    <div class="detail-card">
        <div class="card-header">
            <h3>Business Information</h3>
            <span class="status-badge status-{{ vendor.status }}">{{ vendor.get_status_display }}</span>
        </div>
        <div class="card-body">
            <div class="info-row">
                <span class="info-label">Email</span>
                <span class="info-value">{{ vendor.email }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Phone</span>
                <span class="info-value">{{ vendor.phone|default:"Not provided" }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Address</span>
                <span class="info-value">{{ vendor.address|default:"Not provided" }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Commission Rate</span>
                <span class="info-value">{{ vendor.commission_rate }}%</span>
            </div>
            <div class="info-row">
                <span class="info-label">Storefront URL</span>
                <span class="info-value">
                    <a href="/v/{{ vendor.slug }}/" target="_blank">/v/{{ vendor.slug }}/</a>
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">Registered</span>
                <span class="info-value">{{ vendor.created_at|date:"M d, Y H:i" }}</span>
            </div>
        </div>
    </div>

    <!-- Owner Info -->
    <div class="detail-card">
        <div class="card-header">
            <h3>Owner Account</h3>
        </div>
        <div class="card-body">
            {% if vendor.owner %}
            <div class="owner-info">
                <div class="owner-avatar">{{ vendor.owner.first_name.0|default:vendor.owner.email.0|upper }}</div>
                <div class="owner-details">
                    <span class="owner-name">{{ vendor.owner.get_full_name|default:vendor.owner.email }}</span>
                    <span class="owner-email">{{ vendor.owner.email }}</span>
                </div>
            </div>
            <div class="info-row">
                <span class="info-label">Linked On</span>
                <span class="info-value">{{ vendor.owner.date_joined|date:"M d, Y" }}</span>
            </div>
            {% else %}
            <div class="not-linked">
                <i class="fas fa-user-clock"></i>
                <p>Waiting for owner to log in with <strong>{{ vendor.email }}</strong></p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Subscription Info -->
    <div class="detail-card full-width">
        <div class="card-header">
            <h3>Subscription Information</h3>
            <span class="subscription-badge subscription-{{ vendor.subscription_status }}">
                {{ vendor.get_subscription_status_display }}
            </span>
        </div>
        <div class="card-body">
            <div class="subscription-grid">
                <div class="subscription-item">
                    <span class="subscription-label">Current Plan</span>
                    <span class="subscription-value">
                        {% if vendor.plan == 'professional' %}
                        <span class="plan-badge plan-pro">Professional Pack</span>
                        {% else %}
                        <span class="plan-badge plan-starter">Starter Pack</span>
                        {% endif %}
                    </span>
                </div>
                <div class="subscription-item">
                    <span class="subscription-label">Status</span>
                    <span class="subscription-value">
                        {% if vendor.subscription_status == 'trial' %}
                        <span class="status-text status-trial"><i class="fas fa-clock"></i> Trial Period</span>
                        {% elif vendor.subscription_status == 'active' %}
                        <span class="status-text status-active"><i class="fas fa-check-circle"></i> Active</span>
                        {% elif vendor.subscription_status == 'expired' %}
                        <span class="status-text status-expired"><i class="fas fa-exclamation-triangle"></i> Expired</span>
                        {% else %}
                        <span class="status-text status-cancelled"><i class="fas fa-times-circle"></i> Cancelled</span>
                        {% endif %}
                    </span>
                </div>
                <div class="subscription-item">
                    <span class="subscription-label">Trial Start</span>
                    <span class="subscription-value">{{ vendor.trial_start_date|date:"M d, Y H:i"|default:"-" }}</span>
                </div>
                <div class="subscription-item">
                    <span class="subscription-label">Trial End</span>
                    <span class="subscription-value">{{ vendor.trial_end_date|date:"M d, Y H:i"|default:"-" }}</span>
                </div>
                {% if vendor.subscription_status == 'trial' %}
                <div class="subscription-item">
                    <span class="subscription-label">Days Remaining</span>
                    <span class="subscription-value">
                        {% if vendor.trial_days_remaining > 3 %}
                        <span class="days-badge days-ok">{{ vendor.trial_days_remaining }} days</span>
                        {% elif vendor.trial_days_remaining > 0 %}
                        <span class="days-badge days-warning">{{ vendor.trial_days_remaining }} days</span>
                        {% else %}
                        <span class="days-badge days-expired">Expired</span>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
            </div>

            <!-- Admin Actions for Subscription -->
            <div class="subscription-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="showExtendTrialModal()">
                    <i class="fas fa-calendar-plus"></i> Extend Trial
                </button>
                <button type="button" class="btn btn-outline btn-sm" onclick="showChangePlanModal()">
                    <i class="fas fa-exchange-alt"></i> Change Plan
                </button>
                {% if vendor.subscription_status != 'active' %}
                <form method="post" action="{% url 'vendor_admin:activate_subscription' vendor.pk %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-sm">
                        <i class="fas fa-check"></i> Activate Subscription
                    </button>
                </form>
                {% endif %}
                {% if vendor.subscription_status == 'trial' or vendor.subscription_status == 'active' %}
                <form method="post" action="{% url 'vendor_admin:cancel_trial' vendor.pk %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to cancel this trial? The vendor will lose access immediately.');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm">
                        <i class="fas fa-times"></i> Cancel Trial
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Stats -->
    <div class="detail-card full-width">
        <div class="card-header">
            <h3>Business Statistics</h3>
        </div>
        <div class="card-body">
            <div class="stats-row">
                <div class="mini-stat">
                    <span class="mini-stat-value">{{ stats.total_products }}</span>
                    <span class="mini-stat-label">Products</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-value">{{ stats.total_orders }}</span>
                    <span class="mini-stat-label">Orders</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-value">Rs. {{ stats.total_revenue|floatformat:0 }}</span>
                    <span class="mini-stat-label">Revenue</span>
                </div>
                <div class="mini-stat">
                    <span class="mini-stat-value">Rs. {{ stats.commission_earned|floatformat:0 }}</span>
                    <span class="mini-stat-label">Commission Earned</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="detail-card full-width">
        <div class="card-header">
            <h3>Actions</h3>
        </div>
        <div class="card-body">
            <div class="action-buttons-row">
                {% if vendor.status == 'pending' %}
                <form method="post" action="{% url 'vendor_admin:approve' vendor.pk %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check"></i>
                        Approve Business
                    </button>
                </form>
                <form method="post" action="{% url 'vendor_admin:reject' vendor.pk %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-times"></i>
                        Reject Business
                    </button>
                </form>
                {% elif vendor.status == 'approved' %}
                <form method="post" action="{% url 'vendor_admin:suspend' vendor.pk %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-pause"></i>
                        Suspend Business
                    </button>
                </form>
                {% elif vendor.status == 'suspended' %}
                <form method="post" action="{% url 'vendor_admin:approve' vendor.pk %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-play"></i>
                        Reactivate Business
                    </button>
                </form>
                {% endif %}

                <a href="/v/{{ vendor.slug }}/" class="btn btn-outline" target="_blank">
                    <i class="fas fa-external-link-alt"></i>
                    Visit Storefront
                </a>
                <a href="/vendor/?vendor_id={{ vendor.pk }}" class="btn btn-primary">
                    <i class="fas fa-tachometer-alt"></i>
                    Manage Vendor Dashboard
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    .detail-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }

    @media (max-width: 1024px) {
        .detail-grid {
            grid-template-columns: 1fr;
        }
    }

    .detail-card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: hidden;
    }

    .detail-card.full-width {
        grid-column: 1 / -1;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border);
    }

    .card-header h3 {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text);
    }

    .card-body {
        padding: 1.5rem;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border);
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        color: var(--text-secondary);
    }

    .info-value {
        color: var(--text);
        font-weight: 500;
    }

    .info-value a {
        color: var(--primary);
        text-decoration: none;
    }

    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .status-approved { background: #d1fae5; color: #065f46; }
    .status-pending { background: #fef3c7; color: #92400e; }
    .status-suspended { background: #fee2e2; color: #991b1b; }

    .owner-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .owner-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        font-weight: 600;
    }

    .owner-name {
        font-weight: 600;
        color: var(--text);
        display: block;
    }

    .owner-email {
        color: var(--text-secondary);
    }

    .not-linked {
        text-align: center;
        padding: 2rem;
        color: var(--text-secondary);
    }

    .not-linked i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .stats-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
    }

    @media (max-width: 768px) {
        .stats-row {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .mini-stat {
        text-align: center;
        padding: 1.5rem;
        background: var(--bg);
        border-radius: 12px;
    }

    .mini-stat-value {
        display: block;
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text);
    }

    .mini-stat-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
    }

    .action-buttons-row {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .btn-success {
        background: #10b981;
        color: white;
        border: none;
    }

    .btn-warning {
        background: #f59e0b;
        color: white;
        border: none;
    }

    .btn-danger {
        background: #ef4444;
        color: white;
        border: none;
    }

    .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.8125rem;
    }

    /* Subscription Section */
    .subscription-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    @media (max-width: 768px) {
        .subscription-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .subscription-item {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .subscription-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .subscription-value {
        font-weight: 500;
        color: var(--text);
    }

    .subscription-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .subscription-trial { background: #fef3c7; color: #92400e; }
    .subscription-active { background: #d1fae5; color: #065f46; }
    .subscription-expired { background: #fee2e2; color: #991b1b; }
    .subscription-cancelled { background: #f3f4f6; color: #6b7280; }

    .plan-badge {
        padding: 0.375rem 0.75rem;
        border-radius: 8px;
        font-size: 0.8125rem;
        font-weight: 600;
    }

    .plan-starter { background: #dbeafe; color: #1e40af; }
    .plan-pro { background: #ede9fe; color: #5b21b6; }

    .status-text {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .status-trial { color: #d97706; }
    .status-active { color: #059669; }
    .status-expired { color: #dc2626; }
    .status-cancelled { color: #6b7280; }

    .days-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.8125rem;
        font-weight: 600;
    }

    .days-ok { background: #d1fae5; color: #065f46; }
    .days-warning { background: #fef3c7; color: #92400e; }
    .days-expired { background: #fee2e2; color: #991b1b; }

    .subscription-actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        padding-top: 1rem;
        border-top: 1px solid var(--border);
    }

    /* Modal */
    .modal {
        position: fixed;
        inset: 0;
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.5);
    }

    .modal.active { display: flex; }

    .modal-content {
        background: white;
        border-radius: 12px;
        width: 100%;
        max-width: 400px;
        margin: 1rem;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border);
    }

    .modal-header h3 {
        margin: 0;
        font-size: 1.125rem;
        font-weight: 600;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #6b7280;
    }

    .modal-body { padding: 1.5rem; }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--border);
    }

    .form-group { margin-bottom: 1rem; }
    .form-group:last-child { margin-bottom: 0; }

    .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .form-input, .form-select {
        width: 100%;
        padding: 0.625rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 0.875rem;
    }

    .form-input:focus, .form-select:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    /* Edit Modal Styles */
    .edit-modal .modal-content {
        background: var(--card-bg);
        max-width: 800px;
        max-height: 90vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .modal-lg {
        width: 100%;
    }

    .edit-modal .modal-header {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        border-bottom: none;
    }

    .edit-modal .modal-header h3 {
        color: white;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .edit-modal .modal-close {
        color: white;
        opacity: 0.8;
    }

    .edit-modal .modal-close:hover {
        opacity: 1;
    }

    .edit-modal .modal-body {
        overflow-y: auto;
        flex: 1;
        padding: 1.5rem;
    }

    .edit-form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }

    @media (max-width: 768px) {
        .edit-form-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
    }

    .edit-form-section .section-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .edit-form-section .section-title i {
        color: var(--primary);
    }

    .form-hint {
        display: block;
        margin-top: 0.25rem;
        color: var(--text-secondary);
        font-size: 0.75rem;
    }

    .status-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
    }

    .status-option {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem;
        border: 2px solid var(--border);
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
        background: var(--bg);
    }

    .status-option:hover {
        border-color: var(--primary);
    }

    .status-option.active {
        border-color: var(--primary);
        background: rgba(99, 102, 241, 0.1);
    }

    .status-option input {
        display: none;
    }

    .status-icon {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
    }

    .status-icon.approved {
        background: #d1fae5;
        color: #065f46;
    }

    .status-icon.pending {
        background: #fef3c7;
        color: #92400e;
    }

    .status-icon.suspended {
        background: #fee2e2;
        color: #991b1b;
    }

    .status-icon.rejected {
        background: #fce7f3;
        color: #9d174d;
    }

    .status-option span:last-child {
        font-size: 0.8125rem;
        font-weight: 500;
        color: var(--text);
    }

    .edit-modal .modal-footer {
        background: var(--bg);
        border-top: 1px solid var(--border);
        padding: 1rem 1.5rem;
    }

    .edit-modal .btn i {
        margin-right: 0.375rem;
    }
</style>

<!-- Extend Trial Modal -->
<div class="modal" id="extendTrialModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Extend Trial Period</h3>
            <button type="button" class="modal-close" onclick="hideExtendTrialModal()">&times;</button>
        </div>
        <form method="post" action="{% url 'vendor_admin:extend_trial' vendor.pk %}">
            {% csrf_token %}
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Additional Days</label>
                    <input type="number" name="days" class="form-input" value="7" min="1" max="90">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="hideExtendTrialModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Extend Trial</button>
            </div>
        </form>
    </div>
</div>

<!-- Change Plan Modal -->
<div class="modal" id="changePlanModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Change Plan</h3>
            <button type="button" class="modal-close" onclick="hideChangePlanModal()">&times;</button>
        </div>
        <form method="post" action="{% url 'vendor_admin:change_plan' vendor.pk %}">
            {% csrf_token %}
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Select Plan</label>
                    <select name="plan" class="form-select">
                        <option value="starter" {% if vendor.plan == 'starter' %}selected{% endif %}>Starter Pack</option>
                        <option value="professional" {% if vendor.plan == 'professional' %}selected{% endif %}>Professional Pack</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="hideChangePlanModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Change Plan</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Business Modal -->
<div class="modal edit-modal" id="editBusinessModal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h3><i class="fas fa-edit"></i> Edit Business</h3>
            <button type="button" class="modal-close" onclick="hideEditModal()">&times;</button>
        </div>
        <form method="post" action="{% url 'vendor_admin:edit' vendor.pk %}" id="editBusinessForm">
            {% csrf_token %}
            <div class="modal-body">
                <div class="edit-form-grid">
                    <!-- Left Column -->
                    <div class="edit-form-section">
                        <h4 class="section-title"><i class="fas fa-building"></i> Business Details</h4>

                        <div class="form-group">
                            <label class="form-label">Business Name *</label>
                            <input type="text" name="business_name" class="form-input" value="{{ vendor.business_name }}" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Business Email *</label>
                            <input type="email" name="email" class="form-input" value="{{ vendor.email }}" required>
                            <small class="form-hint">Used to link vendor account</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea name="description" class="form-input" rows="3" placeholder="Brief description...">{{ vendor.description }}</textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Address</label>
                            <textarea name="address" class="form-input" rows="2" placeholder="Business address...">{{ vendor.address }}</textarea>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="edit-form-section">
                        <h4 class="section-title"><i class="fas fa-cog"></i> Settings</h4>

                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="text" name="phone" class="form-input" value="{{ vendor.phone }}" placeholder="+977-XXXXXXXXXX">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Commission Rate (%)</label>
                            <input type="number" name="commission_rate" class="form-input" value="{{ vendor.commission_rate }}" min="0" max="100" step="0.01">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <div class="status-options">
                                <label class="status-option {% if vendor.status == 'approved' %}active{% endif %}">
                                    <input type="radio" name="status" value="approved" {% if vendor.status == 'approved' %}checked{% endif %}>
                                    <span class="status-icon approved"><i class="fas fa-check-circle"></i></span>
                                    <span>Approved</span>
                                </label>
                                <label class="status-option {% if vendor.status == 'pending' %}active{% endif %}">
                                    <input type="radio" name="status" value="pending" {% if vendor.status == 'pending' %}checked{% endif %}>
                                    <span class="status-icon pending"><i class="fas fa-clock"></i></span>
                                    <span>Pending</span>
                                </label>
                                <label class="status-option {% if vendor.status == 'suspended' %}active{% endif %}">
                                    <input type="radio" name="status" value="suspended" {% if vendor.status == 'suspended' %}checked{% endif %}>
                                    <span class="status-icon suspended"><i class="fas fa-pause-circle"></i></span>
                                    <span>Suspended</span>
                                </label>
                                <label class="status-option {% if vendor.status == 'rejected' %}active{% endif %}">
                                    <input type="radio" name="status" value="rejected" {% if vendor.status == 'rejected' %}checked{% endif %}>
                                    <span class="status-icon rejected"><i class="fas fa-times-circle"></i></span>
                                    <span>Rejected</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="hideEditModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function showExtendTrialModal() {
    document.getElementById('extendTrialModal').classList.add('active');
}

function hideExtendTrialModal() {
    document.getElementById('extendTrialModal').classList.remove('active');
}

function showChangePlanModal() {
    document.getElementById('changePlanModal').classList.add('active');
}

function hideChangePlanModal() {
    document.getElementById('changePlanModal').classList.remove('active');
}

function showEditModal() {
    document.getElementById('editBusinessModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function hideEditModal() {
    document.getElementById('editBusinessModal').classList.remove('active');
    document.body.style.overflow = '';
}

// Close modal on backdrop click
document.getElementById('editBusinessModal').addEventListener('click', function(e) {
    if (e.target === this) {
        hideEditModal();
    }
});

// Close modal on Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        hideEditModal();
        hideExtendTrialModal();
        hideChangePlanModal();
    }
});

// Update status option styling on change
document.querySelectorAll('.status-option input').forEach(input => {
    input.addEventListener('change', function() {
        document.querySelectorAll('.status-option').forEach(opt => opt.classList.remove('active'));
        this.closest('.status-option').classList.add('active');
    });
});

// Auto-open edit modal if ?edit=true in URL
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('edit') === 'true') {
        showEditModal();
        // Remove the query param from URL without reload
        window.history.replaceState({}, document.title, window.location.pathname);
    }
});
</script>
{% endblock %}
