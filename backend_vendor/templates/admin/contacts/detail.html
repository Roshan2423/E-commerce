{% extends 'admin/base.html' %}
{% load static %}

{% block title %}Message from {{ contact.name }} - E-Commerce Admin{% endblock %}

{% block content %}
<div class="page-header" style="display: flex; align-items: center; justify-content: space-between;">
    <div>
        <a href="{% url 'contacts:contact_list' %}" style="color: #6b7280; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; margin-bottom: 8px;">
            <i class="fas fa-arrow-left"></i> Back to Messages
        </a>
        <h1 class="page-title">Message Details</h1>
    </div>
    <form method="POST" action="{% url 'contacts:contact_delete' contact.pk %}" onsubmit="return confirm('Are you sure you want to delete this message?');" style="margin: 0;">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">
            <i class="fas fa-trash"></i> Delete
        </button>
    </form>
</div>

{% if messages %}
<div style="margin-bottom: 20px;">
    {% for message in messages %}
    <div style="padding: 12px 16px; background: #d1fae5; color: #047857; border-radius: 8px; margin-bottom: 8px;">
        <i class="fas fa-check-circle"></i> {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
    <!-- Message Content -->
    <div class="data-table">
        <div class="table-header">
            <h3 class="table-title">
                <i class="fas fa-envelope" style="margin-right: 8px;"></i>
                Message from {{ contact.name }}
            </h3>
        </div>
        <div style="padding: 24px;">
            <!-- Contact Info -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #e2e8f0;">
                <div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Name</div>
                    <div style="font-weight: 600; color: #1f2937;">{{ contact.name }}</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Email</div>
                    <div style="font-weight: 600; color: #1f2937;">
                        <a href="mailto:{{ contact.email }}" style="color: #667eea; text-decoration: none;">{{ contact.email }}</a>
                    </div>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Phone</div>
                    <div style="font-weight: 600; color: #1f2937;">
                        {% if contact.phone %}
                        <a href="tel:{{ contact.phone }}" style="color: #667eea; text-decoration: none;">{{ contact.phone }}</a>
                        {% else %}
                        <span style="color: #9ca3af;">Not provided</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Subject -->
            <div style="margin-bottom: 20px;">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">Subject</div>
                <span style="padding: 6px 14px; border-radius: 8px; font-size: 14px; font-weight: 600;
                    {% if contact.subject == 'complaint' %}background: #fee2e2; color: #b91c1c;
                    {% elif contact.subject == 'order' %}background: #dbeafe; color: #1d4ed8;
                    {% elif contact.subject == 'feedback' %}background: #d1fae5; color: #047857;
                    {% else %}background: #f3f4f6; color: #374151;{% endif %}">
                    {{ contact.get_subject_display }}
                </span>
            </div>

            <!-- Message -->
            <div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">Message</div>
                <div style="background: #f8fafc; border-radius: 12px; padding: 20px; line-height: 1.7; color: #374151; white-space: pre-wrap;">{{ contact.message }}</div>
            </div>

            <!-- Reply Button -->
            <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #e2e8f0;">
                <a href="mailto:{{ contact.email }}?subject=Re: {{ contact.get_subject_display }}" class="btn btn-primary" style="padding: 14px 24px;">
                    <i class="fas fa-reply"></i> Reply via Email
                </a>
            </div>
        </div>
    </div>

    <!-- Status & Notes Panel -->
    <div>
        <!-- Status Card -->
        <div class="data-table" style="margin-bottom: 24px;">
            <div class="table-header">
                <h3 class="table-title">
                    <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                    Status
                </h3>
            </div>
            <div style="padding: 20px;">
                <form method="POST">
                    {% csrf_token %}
                    <div style="margin-bottom: 16px;">
                        <label style="font-size: 12px; color: #6b7280; display: block; margin-bottom: 8px;">Current Status</label>
                        <select name="status" style="width: 100%; padding: 12px 14px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; font-size: 14px;">
                            {% for choice in status_choices %}
                            <option value="{{ choice.0 }}" {% if choice.0 == contact.status %}selected{% endif %}>{{ choice.1 }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div style="margin-bottom: 16px;">
                        <label style="font-size: 12px; color: #6b7280; display: block; margin-bottom: 8px;">Admin Notes</label>
                        <textarea name="admin_notes" rows="4" placeholder="Add internal notes here..." style="width: 100%; padding: 12px 14px; border: 1px solid #e2e8f0; border-radius: 8px; resize: vertical; font-size: 14px;">{{ contact.admin_notes|default:"" }}</textarea>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> Update
                    </button>
                </form>
            </div>
        </div>

        <!-- Timeline Card -->
        <div class="data-table">
            <div class="table-header">
                <h3 class="table-title">
                    <i class="fas fa-clock" style="margin-right: 8px;"></i>
                    Timeline
                </h3>
            </div>
            <div style="padding: 20px;">
                <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                    <div style="width: 10px; height: 10px; background: #667eea; border-radius: 50%; margin-top: 5px;"></div>
                    <div>
                        <div style="font-weight: 600; color: #1f2937;">Message Received</div>
                        <div style="font-size: 13px; color: #6b7280;">{{ contact.created_at|date:"M d, Y H:i" }}</div>
                    </div>
                </div>
                {% if contact.updated_at != contact.created_at %}
                <div style="display: flex; gap: 12px;">
                    <div style="width: 10px; height: 10px; background: #10b981; border-radius: 50%; margin-top: 5px;"></div>
                    <div>
                        <div style="font-weight: 600; color: #1f2937;">Last Updated</div>
                        <div style="font-size: 13px; color: #6b7280;">{{ contact.updated_at|date:"M d, Y H:i" }}</div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
