{% extends 'vendor/starter/base.html' %}

{% block title %}Orders{% endblock %}
{% block breadcrumb %}All Orders{% endblock %}

{% block extra_css %}
<style>
    .order-stats-row {
        display: flex !important;
        flex-direction: row !important;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .order-stat-item {
        background: white;
        border-radius: 10px;
        padding: 1rem 1.25rem;
        border: 1px solid #e2e8f0;
        display: inline-flex !important;
        align-items: center;
        gap: 0.75rem;
    }

    .order-stat-item .icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
    }

    .order-stat-item .icon.purple { background: #ede9fe; color: #7c3aed; }
    .order-stat-item .icon.yellow { background: #fef3c7; color: #d97706; }
    .order-stat-item .icon.blue { background: #dbeafe; color: #2563eb; }
    .order-stat-item .icon.green { background: #d1fae5; color: #059669; }

    .order-stat-item .value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1e293b;
    }

    .order-stat-item .label {
        font-size: 0.8125rem;
        color: #64748b;
    }

    .filter-bar {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .filter-bar .form-control {
        width: auto;
    }

    .order-id {
        color: var(--primary);
        font-weight: 600;
    }

    .customer-info {
        display: flex;
        flex-direction: column;
    }

    .customer-name {
        font-weight: 500;
    }

    .customer-email {
        font-size: 0.75rem;
        color: var(--text-secondary);
    }

    .order-amount {
        font-weight: 700;
    }

    .status-dropdown {
        position: relative;
        display: inline-block;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
    }

    .empty-state i {
        font-size: 4rem;
        color: #cbd5e1;
        margin-bottom: 1rem;
    }

    .empty-state h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: var(--text-secondary);
    }

</style>
{% endblock %}

{% block content %}
<div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
        <h1 class="page-title">Orders</h1>
        <p class="page-subtitle">Manage and track customer orders</p>
    </div>
</div>

<!-- Order Stats -->
<div class="order-stats-row">
    <div class="order-stat-item">
        <div class="icon purple"><i class="fas fa-shopping-bag"></i></div>
        <div class="value">{{ total_orders|default:0 }}</div>
        <div class="label">Total</div>
    </div>
    <div class="order-stat-item">
        <div class="icon yellow"><i class="fas fa-clock"></i></div>
        <div class="value">{{ pending_orders|default:0 }}</div>
        <div class="label">Pending</div>
    </div>
    <div class="order-stat-item">
        <div class="icon blue"><i class="fas fa-sync"></i></div>
        <div class="value">{{ processing_orders|default:0 }}</div>
        <div class="label">Processing</div>
    </div>
    <div class="order-stat-item">
        <div class="icon green"><i class="fas fa-check-circle"></i></div>
        <div class="value">{{ completed_orders|default:0 }}</div>
        <div class="label">Completed</div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">All Orders</h3>
        <div class="filter-bar">
            <input type="text" class="form-control" placeholder="Search orders..." style="width: 200px;" id="searchInput">
            <select class="form-control" id="statusFilter">
                <option value="">All Status</option>
                <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="processing" {% if request.GET.status == 'processing' %}selected{% endif %}>Processing</option>
                <option value="shipped" {% if request.GET.status == 'shipped' %}selected{% endif %}>Shipped</option>
                <option value="delivered" {% if request.GET.status == 'delivered' %}selected{% endif %}>Delivered</option>
                <option value="cancelled" {% if request.GET.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
            </select>
            <select class="form-control" id="paymentFilter">
                <option value="">All Payment</option>
                <option value="paid" {% if request.GET.payment == 'paid' %}selected{% endif %}>Paid</option>
                <option value="unpaid" {% if request.GET.payment == 'unpaid' %}selected{% endif %}>Unpaid</option>
            </select>
        </div>
    </div>

    {% if order_items %}
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Payment</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order_items %}
                <tr>
                    <td><span class="order-id">#{{ item.order.get_order_number }}</span></td>
                    <td>
                        <div class="customer-info">
                            <span class="customer-name">{{ item.order.user.get_full_name|default:item.order.guest_email|default:"Guest User" }}</span>
                            <span class="customer-email">{{ item.order.user.email|default:item.order.guest_email|default:"guest@example.com" }}</span>
                        </div>
                    </td>
                    <td>{{ item.order.created_at|date:"M d, Y H:i" }}</td>
                    <td><span class="order-amount">Rs. {{ item.total_price|floatformat:0 }}</span></td>
                    <td>
                        {% if item.order.payment_status == 'paid' %}
                        <span class="badge badge-success">Paid</span>
                        {% else %}
                        <span class="badge badge-warning">Unpaid</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="status-dropdown">
                            {% if item.order.status == 'delivered' %}
                            <span class="badge badge-success">Delivered</span>
                            {% elif item.order.status == 'shipped' %}
                            <span class="badge badge-info">Shipped</span>
                            {% elif item.order.status == 'processing' %}
                            <span class="badge badge-info">Processing</span>
                            {% elif item.order.status == 'pending' %}
                            <span class="badge badge-warning">Pending</span>
                            {% elif item.order.status == 'cancelled' %}
                            <span class="badge badge-danger">Cancelled</span>
                            {% else %}
                            <span class="badge badge-secondary">{{ item.order.status|title }}</span>
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        <a href="{% url 'vendor:order_detail' item.order.order_id %}" class="btn btn-outline btn-sm">
                            <i class="fas fa-eye"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-inbox"></i>
        <h3>No Orders Yet</h3>
        <p>Orders will appear here once customers start buying from your store.</p>
        <a href="{% url 'vendor:product_add' %}" class="btn btn-primary" style="margin-top: 1rem;">
            <i class="fas fa-plus"></i> Add Products
        </a>
    </div>
    {% endif %}
</div>

<!-- Pagination -->
{% if order_items.has_other_pages %}
<div class="pagination" style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 1.5rem;">
    {% if order_items.has_previous %}
    <a href="?page={{ order_items.previous_page_number }}" class="btn btn-outline btn-sm">
        <i class="fas fa-chevron-left"></i>
    </a>
    {% endif %}

    {% for num in order_items.paginator.page_range %}
        {% if order_items.number == num %}
        <span class="btn btn-primary btn-sm">{{ num }}</span>
        {% elif num > order_items.number|add:'-3' and num < order_items.number|add:'3' %}
        <a href="?page={{ num }}" class="btn btn-outline btn-sm">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if order_items.has_next %}
    <a href="?page={{ order_items.next_page_number }}" class="btn btn-outline btn-sm">
        <i class="fas fa-chevron-right"></i>
    </a>
    {% endif %}
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('statusFilter').addEventListener('change', function() {
        const params = new URLSearchParams(window.location.search);
        if (this.value) {
            params.set('status', this.value);
        } else {
            params.delete('status');
        }
        window.location.href = '?' + params.toString();
    });

    document.getElementById('paymentFilter').addEventListener('change', function() {
        const params = new URLSearchParams(window.location.search);
        if (this.value) {
            params.set('payment', this.value);
        } else {
            params.delete('payment');
        }
        window.location.href = '?' + params.toString();
    });
</script>
{% endblock %}
